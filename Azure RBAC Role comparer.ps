param(
    [string]$roleName1,
    [string]$roleName2,
    [string]$roleName3
)

# Make sure you're connected to Azure
#Connect-AzAccount

# Fetch role definitions from Azure using the provided role names
$role1 = Get-AzRoleDefinition $roleName1
$role2 = Get-AzRoleDefinition $roleName2
$role3 = Get-AzRoleDefinition $roleName3

# Extract the permissions (actions) from each role
$role1Perms = $role1.Actions
$role2Perms = $role2.Actions
$role3Perms = $role3.Actions

# Create an empty array to hold the output data
$output = @()

# Combine all permissions in a set to eliminate duplicates
$allPermissions = $role1Perms + $role2Perms + $role3Perms | Sort-Object -Unique

# Generate the output data with permissions and role mappings
foreach ($perm in $allPermissions) {
    $output += [PSCustomObject]@{
        Permission = $perm
        Role1 = $(if ($role1Perms -contains $perm) { "✔" } else { "" })
        Role2 = $(if ($role2Perms -contains $perm) { "✔" } else { "" })
        Role3 = $(if ($role3Perms -contains $perm) { "✔" } else { "" })
    }
}

# Output the data in a table format
$output | Format-Table -AutoSize



.\Compare-AzRoles.ps1 -roleName1 "Global Administrator" -roleName2 "Groups Administrator" -roleName3 "User Access Administrator"
